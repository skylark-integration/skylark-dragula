/**
 * skylark-dragula - A version of dragula.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-dragula/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx-emitter/Emitter","skylark-devices-points/mouse","skylark-devices-points/touch","skylark-domx-noder","skylark-domx-finder","skylark-domx-geom","skylark-domx-eventer","skylark-domx-styler","./_helpers"],function(i,t,e,n,r,s,o,h,a,c){"use strict";return t.inherit({_source:null,_item:null,_initialSibling:null,_currentSibling:null,_renderTimer:null,_copy:null,_lastDropTarget:null,_prepareArgs:function(i,t){return t},init:function(i){this.containers=i.containers,this.destroy=i.destroy,this.options=i,this.dragging=!1},isContainer:function(i){return-1!==this.containers.indexOf(i)||this.options.isContainer(i)},isCopy:function(i,t){var e=this.options;return"boolean"==typeof e.copy?e.copy:e.copy(i,t)},findDropTarget:function(i,t){for(var e=r.fromPoint(i,t),n=e,o=this;n&&!h();)n=s.parent(n);return n;function h(){if(!1===o.isContainer(n))return!1;var r=o.getImmediateChild(n,e),s=o.getReference(n,r,i,t);return!!o.isInitialPlacement(n,s)||o.options.accepts(o._item,n,o._source,s)}},isInitialPlacement:function(i,t){var e;return e=void 0!==t?t:s.nextSibling(this._copy||this._item),i===this._source&&e===this._initialSibling},getReference:function(i,t,e,n){var r="horizontal"===this.options.direction;return t!==i?function(){var i=o.boundingRect(t);if(r)return h(e>i.left+c.getRectWidth(i)/2);return h(n>i.top+c.getRectHeight(i)/2)}():function(){var t=i.children.length;for(let s=0;s<t;s++){let t=i.children[s],h=o.boundingRect(t);if(r&&h.left+h.width/2>e)return t;if(!r&&h.top+h.height/2>n)return t}return null}();function h(i){return i?s.nextSibling(t):t}},getImmediateChild:function(i,t){for(var e=t;e!==i&&s.parent(e)!==i;)e=s.parent(e);return e===r.root()?null:e},canStart:function(i){if(!this.dragging&&!(this.isContainer(i)||this.options.ignoreInputTextSelection&&r.isInput(i))){for(var t=i,e=this.options;s.parent(i)&&!1===this.isContainer(s.parent(i));){if(e.invalid(i,t))return;if(!(i=s.parent(i)))return}var n=s.parent(i);if(n)if(!e.invalid(i,t))if(e.moves(i,n,t,s.nextSibling(i)))return{item:i,source:n}}},canMove:function(i){return!!this.canStart(i)},manualStart:function(i){var t=this.canStart(i);t&&this.start(t)},start:function(i){this.isCopy(i.item,i.source)&&(this._copy=i.item.cloneNode(!0),this.emit("cloned",this._copy,i.item,"copy")),this._source=i.source,this._item=i.item,this._initialSibling=this._currentSibling=s.nextSibling(i.item),this.dragging=!0,this.emit("drag",this._item,this._source)},over:function(i,t){var e=this.options,n=this._copy||this._item,o=this,h=r.fromPoint(i,t),a=this.findDropTarget(i,t),c=null!==a&&a!==this._lastDropTarget;(c||null===a)&&(o._lastDropTarget&&_("out"),this._lastDropTarget=a,c&&_("over"));var l=s.parent(n);if(a!==this._source||!this._copy||e.copySortSource){var u,p=this.getImmediateChild(a,h);if(null!==p)u=this.getReference(a,p,i,t);else{if(!0!==e.revertOnSpill||this._copy)return void(this._copy&&l&&l.removeChild(n));u=this._initialSibling,a=this._source}(null===u&&c||u!==n&&u!==s.nextSibling(n))&&(this._currentSibling=u,a.insertBefore(n,u),this.emit("shadow",n,a,this._source))}else l&&l.removeChild(n);function _(i){o.emit(i,n,o._lastDropTarget,o._source)}},end:function(){if(this.dragging){var i=this._copy||this._item;this.drop(i,s.parent(i))}},drop:function(i,t){var e=s.parent(i);this._copy&&this.options.copySortSource&&t===this._source&&e.removeChild(this._item),this.isInitialPlacement(t)?this.emit("cancel",i,this._source,this._source):this.emit("drop",i,t,this._source,this._currentSibling),this.cleanup()},remove:function(){if(this.dragging){var i=this._copy||this._item,t=s.parent(i);t&&t.removeChild(i),this.emit(_copy?"cancel":"remove",i,t,this._source),this.cleanup()}},cancel:function(i){if(this.dragging){var t=this.options,e=arguments.length>0?i:t.revertOnSpill,n=this._copy||this._item,r=s.parent(n),o=this.isInitialPlacement(r);!1===o&&e&&(this._copy?r&&r.removeChild(this._copy):this._source.insertBefore(n,this._initialSibling)),o||e?this.emit("cancel",n,this._source,this._source):this.emit("drop",n,r,this._source,this._currentSibling),this.cleanup()}},cleanup:function(){var i=this._copy||this._item;i&&a.removeClass(i,"gu-transit"),this._renderTimer&&clearTimeout(_renderTimer),this.dragging=!1,this._lastDropTarget&&this.emit("out",i,this._lastDropTarget,this._source),this.emit("dragend",i),this._source=this._item=this._copy=this._initialSibling=this._currentSibling=this._renderTimer=this._lastDropTarget=null}})});
//# sourceMappingURL=sourcemaps/_drake.js.map
