/**
 * skylark-dragula - A version of dragula.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-dragula/
 * @license MIT
 */
define(["skylark-langx/skylark","./emitter","./crossvent","./classes"],function(e,n,t,r){"use strict";var o=window,i=o.document,u=i.documentElement;function c(e,n,r,i){o.navigator.pointerEnabled?t[n](e,{mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"}[r],i):o.navigator.msPointerEnabled?t[n](e,{mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"}[r],i):(t[n](e,{mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"}[r],i),t[n](e,r,i))}function a(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var n=e.button;return void 0!==n?1&n?1:2&n?3:4&n?2:0:void 0}function l(e,n){return void 0!==o[n]?o[n]:u.clientHeight?u[e]:i.body[e]}function d(e,n,t){var r,o=e||{},u=o.className;return o.className+=" gu-hide",r=i.elementFromPoint(n,t),o.className=u,r}function f(){return!1}function v(){return!0}function m(e){return e.width||e.right-e.left}function s(e){return e.height||e.bottom-e.top}function g(e){return e.parentNode===i?null:e.parentNode}function p(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||function e(n){if(!n)return!1;if("false"===n.contentEditable)return!1;if("true"===n.contentEditable)return!0;return e(g(n))}(e)}function h(e){return e.nextElementSibling||function(){var n=e;do{n=n.nextSibling}while(n&&1!==n.nodeType);return n}()}function y(e,n){var t=function(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}(n),r={pageX:"clientX",pageY:"clientY"};return e in r&&!(e in t)&&r[e]in t&&(e=r[e]),t[e]}return e.dragula=function(e,o){var S,C,w,T,b,x,N,O,X,E,Y;1===arguments.length&&!1===Array.isArray(e)&&(o=e,e=[]);var P,B=null,k=o||{};void 0===k.moves&&(k.moves=v),void 0===k.accepts&&(k.accepts=v),void 0===k.invalid&&(k.invalid=function(){return!1}),void 0===k.containers&&(k.containers=e||[]),void 0===k.isContainer&&(k.isContainer=f),void 0===k.copy&&(k.copy=!1),void 0===k.copySortSource&&(k.copySortSource=!1),void 0===k.revertOnSpill&&(k.revertOnSpill=!1),void 0===k.removeOnSpill&&(k.removeOnSpill=!1),void 0===k.direction&&(k.direction="vertical"),void 0===k.ignoreInputTextSelection&&(k.ignoreInputTextSelection=!0),void 0===k.mirrorContainer&&(k.mirrorContainer=i.body);var M=n({containers:k.containers,start:function(e){var n=U(e);n&&z(n)},end:H,cancel:Q,remove:J,destroy:function(){A(!0),q({})},canMove:function(e){return!!U(e)},dragging:!1});return!0===k.removeOnSpill&&M.on("over",function(e){r.rm(e,"gu-hide")}).on("out",function(e){M.dragging&&r.add(e,"gu-hide")}),A(),M;function R(e){return-1!==M.containers.indexOf(e)||k.isContainer(e)}function A(e){var n=e?"remove":"add";c(u,n,"mousedown",K),c(u,n,"mouseup",q)}function D(e){c(u,e?"remove":"add","mousemove",L)}function I(e){var n=e?"remove":"add";t[n](u,"selectstart",F),t[n](u,"click",F)}function F(e){P&&e.preventDefault()}function K(e){if(x=e.clientX,N=e.clientY,1===a(e)&&!e.metaKey&&!e.ctrlKey){var n=e.target,t=U(n);t&&(P=t,D(),"mousedown"===e.type&&(p(n)?n.focus():e.preventDefault()))}}function L(e){if(P)if(0!==a(e)){if(void 0===e.clientX||e.clientX!==x||void 0===e.clientY||e.clientY!==N){if(k.ignoreInputTextSelection){var n=y("clientX",e),t=y("clientY",e);if(p(i.elementFromPoint(n,t)))return}var o=P;D(!0),I(),H(),z(o);var d,f={left:(d=w.getBoundingClientRect()).left+l("scrollLeft","pageXOffset"),top:d.top+l("scrollTop","pageYOffset")};T=y("pageX",e)-f.left,b=y("pageY",e)-f.top,r.add(E||w,"gu-transit"),function(){if(!S){var e=w.getBoundingClientRect();(S=w.cloneNode(!0)).style.width=m(e)+"px",S.style.height=s(e)+"px",r.rm(S,"gu-transit"),r.add(S,"gu-mirror"),k.mirrorContainer.appendChild(S),c(u,"add","mousemove",$),r.add(k.mirrorContainer,"gu-unselectable"),M.emit("cloned",S,w,"mirror")}}(),$(e)}}else q({})}function U(e){if(!(M.dragging&&S||R(e))){for(var n=e;g(e)&&!1===R(g(e));){if(k.invalid(e,n))return;if(!(e=g(e)))return}var t=g(e);if(t&&!k.invalid(e,n)&&k.moves(e,t,n,h(e)))return{item:e,source:t}}}function z(e){var n,t;n=e.item,t=e.source,("boolean"==typeof k.copy?k.copy:k.copy(n,t))&&(E=e.item.cloneNode(!0),M.emit("cloned",E,e.item,"copy")),C=e.source,w=e.item,O=X=h(e.item),M.dragging=!0,M.emit("drag",w,C)}function H(){if(M.dragging){var e=E||w;G(e,g(e))}}function j(){P=!1,D(!0),I(!0)}function q(e){if(j(),M.dragging){var n=E||w,t=y("clientX",e),r=y("clientY",e),o=Z(d(S,t,r),t,r);o&&(E&&k.copySortSource||!E||o!==C)?G(n,o):k.removeOnSpill?J():Q()}}function G(e,n){var t=g(e);E&&k.copySortSource&&n===C&&t.removeChild(w),W(n)?M.emit("cancel",e,C,C):M.emit("drop",e,n,C,X),V()}function J(){if(M.dragging){var e=E||w,n=g(e);n&&n.removeChild(e),M.emit(E?"cancel":"remove",e,n,C),V()}}function Q(e){if(M.dragging){var n=arguments.length>0?e:k.revertOnSpill,t=E||w,r=g(t),o=W(r);!1===o&&n&&(E?r&&r.removeChild(E):C.insertBefore(t,O)),o||n?M.emit("cancel",t,C,C):M.emit("drop",t,r,C,X),V()}}function V(){var e=E||w;j(),S&&(r.rm(k.mirrorContainer,"gu-unselectable"),c(u,"remove","mousemove",$),g(S).removeChild(S),S=null),e&&r.rm(e,"gu-transit"),Y&&clearTimeout(Y),M.dragging=!1,B&&M.emit("out",e,B,C),M.emit("dragend",e),C=w=E=O=X=Y=B=null}function W(e,n){var t;return t=void 0!==n?n:S?X:h(E||w),e===C&&t===O}function Z(e,n,t){for(var r=e;r&&!o();)r=g(r);return r;function o(){if(!1===R(r))return!1;var o=_(r,e),i=ee(r,o,n,t);return!!W(r,i)||k.accepts(w,r,C,i)}}function $(e){if(S){e.preventDefault();var n=y("clientX",e),t=y("clientY",e),r=n-T,o=t-b;S.style.left=r+"px",S.style.top=o+"px";var i=E||w,u=d(S,n,t),c=Z(u,n,t),a=null!==c&&c!==B;(a||null===c)&&(B&&m("out"),B=c,a&&m("over"));var l=g(i);if(c!==C||!E||k.copySortSource){var f,v=_(c,u);if(null!==v)f=ee(c,v,n,t);else{if(!0!==k.revertOnSpill||E)return void(E&&l&&l.removeChild(i));f=O,c=C}(null===f&&a||f!==i&&f!==h(i))&&(X=f,c.insertBefore(i,f),M.emit("shadow",i,c,C))}else l&&l.removeChild(i)}function m(e){M.emit(e,i,B,C)}}function _(e,n){for(var t=n;t!==e&&g(t)!==e;)t=g(t);return t===u?null:t}function ee(e,n,t,r){var o,i="horizontal"===k.direction;return n!==e?(o=n.getBoundingClientRect(),u(i?t>o.left+m(o)/2:r>o.top+s(o)/2)):function(){var n,o,u,c=e.children.length;for(n=0;n<c;n++){if(o=e.children[n],u=o.getBoundingClientRect(),i&&u.left+u.width/2>t)return o;if(!i&&u.top+u.height/2>r)return o}return null}();function u(e){return e?h(n):n}}}});
//# sourceMappingURL=sourcemaps/dragula.js.map
