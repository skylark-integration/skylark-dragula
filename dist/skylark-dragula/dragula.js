/**
 * skylark-dragula - A version of dragula.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-dragula/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-devices-points/mouse","skylark-devices-points/touch","skylark-domx-noder","skylark-domx-finder","skylark-domx-geom","skylark-domx-eventer","./emitter","./crossvent","./classes"],function(e,n,t,r,i,o,c,u,a,l){"use strict";var d=window.document,v=d.documentElement;function f(e,n,r,i){"add"==n?c.on(e,r,i):c.off(e,r,i),e.touchInited||(e.touchInited=!0,t.mousy(e))}function s(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var n=e.button;return void 0!==n?1&n?1:2&n?3:4&n?2:0:void 0}function m(e,n,t){var r,i=e||{},o=i.className;return i.className+=" gu-hide",r=d.elementFromPoint(n,t),i.className=o,r}function g(){return!1}function p(){return!0}function h(e){return e.width||e.right-e.left}function y(e){return e.height||e.bottom-e.top}function S(e){return i.parent(e)}function k(e){return r.isInput(e)}function C(e){return i.nextSibling(e)}function x(e,n){var t=function(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}(n),r={pageX:"clientX",pageY:"clientY"};return e in r&&!(e in t)&&r[e]in t&&(e=r[e]),t[e]}return e.attach("intg.dragula",function(e,n){var t,i,c,b,w,T,O,X,Y,I,N;1===arguments.length&&!1===Array.isArray(e)&&(n=e,e=[]);var B,D=null,P=n||{};void 0===P.moves&&(P.moves=p),void 0===P.accepts&&(P.accepts=p),void 0===P.invalid&&(P.invalid=function(){return!1}),void 0===P.containers&&(P.containers=e||[]),void 0===P.isContainer&&(P.isContainer=g),void 0===P.copy&&(P.copy=!1),void 0===P.copySortSource&&(P.copySortSource=!1),void 0===P.revertOnSpill&&(P.revertOnSpill=!1),void 0===P.removeOnSpill&&(P.removeOnSpill=!1),void 0===P.direction&&(P.direction="vertical"),void 0===P.ignoreInputTextSelection&&(P.ignoreInputTextSelection=!0),void 0===P.mirrorContainer&&(P.mirrorContainer=d.body);var R=u({containers:P.containers,start:function(e){var n=q(e);n&&G(n)},end:H,cancel:V,remove:U,destroy:function(){K(!0),L({})},canMove:function(e){return!!q(e)},dragging:!1});return!0===P.removeOnSpill&&R.on("over",function(e){l.rm(e,"gu-hide")}).on("out",function(e){R.dragging&&l.add(e,"gu-hide")}),K(),R;function A(e){return-1!==R.containers.indexOf(e)||P.isContainer(e)}function K(e){var n=e?"remove":"add";f(v,n,"mousedown",M),f(v,n,"mouseup",L)}function z(e){f(v,e?"remove":"add","mousemove",j)}function E(e){var n=e?"remove":"add";a[n](v,"selectstart",F),a[n](v,"click",F)}function F(e){B&&e.preventDefault()}function M(e){if(T=e.clientX,O=e.clientY,1===s(e)&&!e.metaKey&&!e.ctrlKey){var n=e.target,t=q(n);t&&(B=t,z(),"mousedown"===e.type&&(k(n)?n.focus():e.preventDefault()))}}function j(e){if(B)if(0!==s(e)){if(void 0===e.clientX||e.clientX!==T||void 0===e.clientY||e.clientY!==O){if(P.ignoreInputTextSelection){var n=x("clientX",e),i=x("clientY",e);if(k(r.fromPoint(n,i)))return}var u=B;z(!0),E(),H(),G(u);var a,d=(a=c,o.pagePosition(a));b=x("pageX",e)-d.left,w=x("pageY",e)-d.top,l.add(I||c,"gu-transit"),function(){if(!t){var e=c.getBoundingClientRect();(t=c.cloneNode(!0)).style.width=h(e)+"px",t.style.height=y(e)+"px",l.rm(t,"gu-transit"),l.add(t,"gu-mirror"),P.mirrorContainer.appendChild(t),f(v,"add","mousemove",_),l.add(P.mirrorContainer,"gu-unselectable"),R.emit("cloned",t,c,"mirror")}}(),_(e)}}else L({})}function q(e){if(!(R.dragging&&t||A(e))){for(var n=e;S(e)&&!1===A(S(e));){if(P.invalid(e,n))return;if(!(e=S(e)))return}var r=S(e);if(r&&!P.invalid(e,n)&&P.moves(e,r,n,C(e)))return{item:e,source:r}}}function G(e){var n,t;n=e.item,t=e.source,("boolean"==typeof P.copy?P.copy:P.copy(n,t))&&(I=e.item.cloneNode(!0),R.emit("cloned",I,e.item,"copy")),i=e.source,c=e.item,X=Y=C(e.item),R.dragging=!0,R.emit("drag",c,i)}function H(){if(R.dragging){var e=I||c;Q(e,S(e))}}function J(){B=!1,z(!0),E(!0)}function L(e){if(J(),R.dragging){var n=I||c,r=x("clientX",e),o=x("clientY",e),u=$(m(t,r,o),r,o);u&&(I&&P.copySortSource||!I||u!==i)?Q(n,u):P.removeOnSpill?U():V()}}function Q(e,n){var t=S(e);I&&P.copySortSource&&n===i&&t.removeChild(c),Z(n)?R.emit("cancel",e,i,i):R.emit("drop",e,n,i,Y),W()}function U(){if(R.dragging){var e=I||c,n=S(e);n&&n.removeChild(e),R.emit(I?"cancel":"remove",e,n,i),W()}}function V(e){if(R.dragging){var n=arguments.length>0?e:P.revertOnSpill,t=I||c,r=S(t),o=Z(r);!1===o&&n&&(I?r&&r.removeChild(I):i.insertBefore(t,X)),o||n?R.emit("cancel",t,i,i):R.emit("drop",t,r,i,Y),W()}}function W(){var e=I||c;J(),t&&(l.rm(P.mirrorContainer,"gu-unselectable"),f(v,"remove","mousemove",_),S(t).removeChild(t),t=null),e&&l.rm(e,"gu-transit"),N&&clearTimeout(N),R.dragging=!1,D&&R.emit("out",e,D,i),R.emit("dragend",e),i=c=I=X=Y=N=D=null}function Z(e,n){var r;return r=void 0!==n?n:t?Y:C(I||c),e===i&&r===X}function $(e,n,t){for(var r=e;r&&!o();)r=S(r);return r;function o(){if(!1===A(r))return!1;var o=ee(r,e),u=ne(r,o,n,t);return!!Z(r,u)||P.accepts(c,r,i,u)}}function _(e){if(t){e.preventDefault();var n=x("clientX",e),r=x("clientY",e),o=n-b,u=r-w;t.style.left=o+"px",t.style.top=u+"px";var a=I||c,l=m(t,n,r),d=$(l,n,r),v=null!==d&&d!==D;(v||null===d)&&(D&&p("out"),D=d,v&&p("over"));var f=S(a);if(d!==i||!I||P.copySortSource){var s,g=ee(d,l);if(null!==g)s=ne(d,g,n,r);else{if(!0!==P.revertOnSpill||I)return void(I&&f&&f.removeChild(a));s=X,d=i}(null===s&&v||s!==a&&s!==C(a))&&(Y=s,d.insertBefore(a,s),R.emit("shadow",a,d,i))}else f&&f.removeChild(a)}function p(e){R.emit(e,a,D,i)}}function ee(e,n){for(var t=n;t!==e&&S(t)!==e;)t=S(t);return t===v?null:t}function ne(e,n,t,r){var i,c="horizontal"===P.direction;return n!==e?(i=o.boundingRect(n),u(c?t>i.left+h(i)/2:r>i.top+y(i)/2)):function(){var n,i,u,a=e.children.length;for(n=0;n<a;n++){if(i=e.children[n],u=o.boundingRect(i),c&&u.left+u.width/2>t)return i;if(!c&&u.top+u.height/2>r)return i}return null}();function u(e){return e?C(n):n}}})});
//# sourceMappingURL=sourcemaps/dragula.js.map
