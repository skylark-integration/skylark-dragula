/**
 * skylark-dragula - A version of dragula.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-dragula/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-devices-points/mouse","skylark-devices-points/touch","skylark-domx-noder","skylark-domx-finder","skylark-domx-geom","skylark-domx-eventer","./emitter","./crossvent","./classes"],function(e,n,t,r,i,o,u,c,a,l){"use strict";var d=window.document,v=d.documentElement;function f(e,n,r,i){"add"==n?u.on(e,r,i):u.off(e,r,i),e.touchInited||(e.touchInited=!0,t.mousy(e))}function s(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var n=e.button;return void 0!==n?1&n?1:2&n?3:4&n?2:0:void 0}function m(e,n,t){return d.elementFromPoint(n,t)}function g(){return!1}function p(){return!0}function h(e){return e.width||e.right-e.left}function y(e){return e.height||e.bottom-e.top}function S(e){return i.parent(e)}function k(e){return r.isInput(e)}function C(e){return i.nextSibling(e)}function x(e,n){var t=function(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}(n),r={pageX:"clientX",pageY:"clientY"};return e in r&&!(e in t)&&r[e]in t&&(e=r[e]),t[e]}return e.attach("intg.dragula",function(e,n){var t,i,u,b,w,T,O,X,Y,I,B;1===arguments.length&&!1===Array.isArray(e)&&(n=e,e=[]);var D,P=null,R=n||{};void 0===R.moves&&(R.moves=p),void 0===R.accepts&&(R.accepts=p),void 0===R.invalid&&(R.invalid=function(){return!1}),void 0===R.containers&&(R.containers=e||[]),void 0===R.isContainer&&(R.isContainer=g),void 0===R.copy&&(R.copy=!1),void 0===R.copySortSource&&(R.copySortSource=!1),void 0===R.revertOnSpill&&(R.revertOnSpill=!1),void 0===R.removeOnSpill&&(R.removeOnSpill=!1),void 0===R.direction&&(R.direction="vertical"),void 0===R.ignoreInputTextSelection&&(R.ignoreInputTextSelection=!0),void 0===R.mirrorContainer&&(R.mirrorContainer=d.body);var A=c({containers:R.containers,start:function(e){var n=q(e);n&&G(n)},end:H,cancel:V,remove:U,destroy:function(){N(!0),L({})},canMove:function(e){return!!q(e)},dragging:!1});return!0===R.removeOnSpill&&A.on("over",function(e){l.rm(e,"gu-hide")}).on("out",function(e){A.dragging&&l.add(e,"gu-hide")}),N(),A;function K(e){return-1!==A.containers.indexOf(e)||R.isContainer(e)}function N(e){var n=e?"remove":"add";f(v,n,"mousedown",M),f(v,n,"mouseup",L)}function z(e){f(v,e?"remove":"add","mousemove",j)}function E(e){var n=e?"remove":"add";a[n](v,"selectstart",F),a[n](v,"click",F)}function F(e){D&&e.preventDefault()}function M(e){if(T=e.clientX,O=e.clientY,1===s(e)&&!e.metaKey&&!e.ctrlKey){var n=e.target,t=q(n);t&&(D=t,z(),"mousedown"===e.type&&(k(n)?n.focus():e.preventDefault()))}}function j(e){if(D)if(0!==s(e)){if(void 0===e.clientX||e.clientX!==T||void 0===e.clientY||e.clientY!==O){if(R.ignoreInputTextSelection){var n=x("clientX",e),i=x("clientY",e);if(k(r.fromPoint(n,i)))return}var c=D;z(!0),E(),H(),G(c);var a,d=(a=u,o.pagePosition(a));b=x("pageX",e)-d.left,w=x("pageY",e)-d.top,l.add(I||u,"gu-transit"),function(){if(!t){var e=u.getBoundingClientRect();(t=u.cloneNode(!0)).style.width=h(e)+"px",t.style.height=y(e)+"px",l.rm(t,"gu-transit"),l.add(t,"gu-mirror"),R.mirrorContainer.appendChild(t),f(v,"add","mousemove",_),l.add(R.mirrorContainer,"gu-unselectable"),A.emit("cloned",t,u,"mirror")}}(),_(e)}}else L({})}function q(e){if(!(A.dragging&&t||K(e))){for(var n=e;S(e)&&!1===K(S(e));){if(R.invalid(e,n))return;if(!(e=S(e)))return}var r=S(e);if(r&&!R.invalid(e,n)&&R.moves(e,r,n,C(e)))return{item:e,source:r}}}function G(e){var n,t;n=e.item,t=e.source,("boolean"==typeof R.copy?R.copy:R.copy(n,t))&&(I=e.item.cloneNode(!0),A.emit("cloned",I,e.item,"copy")),i=e.source,u=e.item,X=Y=C(e.item),A.dragging=!0,A.emit("drag",u,i)}function H(){if(A.dragging){var e=I||u;Q(e,S(e))}}function J(){D=!1,z(!0),E(!0)}function L(e){if(J(),A.dragging){var n=I||u,t=x("clientX",e),r=x("clientY",e),o=$(m(0,t,r),t,r);o&&(I&&R.copySortSource||!I||o!==i)?Q(n,o):R.removeOnSpill?U():V()}}function Q(e,n){var t=S(e);I&&R.copySortSource&&n===i&&t.removeChild(u),Z(n)?A.emit("cancel",e,i,i):A.emit("drop",e,n,i,Y),W()}function U(){if(A.dragging){var e=I||u,n=S(e);n&&n.removeChild(e),A.emit(I?"cancel":"remove",e,n,i),W()}}function V(e){if(A.dragging){var n=arguments.length>0?e:R.revertOnSpill,t=I||u,r=S(t),o=Z(r);!1===o&&n&&(I?r&&r.removeChild(I):i.insertBefore(t,X)),o||n?A.emit("cancel",t,i,i):A.emit("drop",t,r,i,Y),W()}}function W(){var e=I||u;J(),t&&(l.rm(R.mirrorContainer,"gu-unselectable"),f(v,"remove","mousemove",_),S(t).removeChild(t),t=null),e&&l.rm(e,"gu-transit"),B&&clearTimeout(B),A.dragging=!1,P&&A.emit("out",e,P,i),A.emit("dragend",e),i=u=I=X=Y=B=P=null}function Z(e,n){var r;return r=void 0!==n?n:t?Y:C(I||u),e===i&&r===X}function $(e,n,t){for(var r=e;r&&!o();)r=S(r);return r;function o(){if(!1===K(r))return!1;var o=ee(r,e),c=ne(r,o,n,t);return!!Z(r,c)||R.accepts(u,r,i,c)}}function _(e){if(t){e.preventDefault();var n=x("clientX",e),r=x("clientY",e),o=n-b,c=r-w;t.style.left=o+"px",t.style.top=c+"px";var a=I||u,l=m(0,n,r),d=$(l,n,r),v=null!==d&&d!==P;(v||null===d)&&(P&&p("out"),P=d,v&&p("over"));var f=S(a);if(d!==i||!I||R.copySortSource){var s,g=ee(d,l);if(null!==g)s=ne(d,g,n,r);else{if(!0!==R.revertOnSpill||I)return void(I&&f&&f.removeChild(a));s=X,d=i}(null===s&&v||s!==a&&s!==C(a))&&(Y=s,d.insertBefore(a,s),A.emit("shadow",a,d,i))}else f&&f.removeChild(a)}function p(e){A.emit(e,a,P,i)}}function ee(e,n){for(var t=n;t!==e&&S(t)!==e;)t=S(t);return t===v?null:t}function ne(e,n,t,r){var i,u="horizontal"===R.direction;return n!==e?(i=o.boundingRect(n),c(u?t>i.left+h(i)/2:r>i.top+y(i)/2)):function(){var n,i,c,a=e.children.length;for(n=0;n<a;n++){if(i=e.children[n],c=o.boundingRect(i),u&&c.left+c.width/2>t)return i;if(!u&&c.top+c.height/2>r)return i}return null}();function c(e){return e?C(n):n}}})});
//# sourceMappingURL=sourcemaps/dragula.js.map
