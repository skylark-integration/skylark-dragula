/**
 * skylark-dragula - A version of dragula.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-dragula/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-devices-points/mouse","skylark-devices-points/touch","skylark-domx-noder","skylark-domx-finder","skylark-domx-geom","skylark-domx-eventer","skylark-domx-styler","./emitter"],function(e,n,t,r,i,o,u,c,a){"use strict";var l=window.document,d=l.documentElement;function v(e,n,r,i){"add"==n?u.on(e,r,i):u.off(e,r,i),e.touchInited||(e.touchInited=!0,t.mousy(e))}function f(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var n=e.button;return void 0!==n?1&n?1:2&n?3:4&n?2:0:void 0}function s(e,n,t){return l.elementFromPoint(n,t)}function m(){return!1}function g(){return!0}function p(e){return e.width||e.right-e.left}function h(e){return e.height||e.bottom-e.top}function y(e){return i.parent(e)}function C(e){return r.isInput(e)}function S(e){return i.nextSibling(e)}function k(e,n){var t=function(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}(n),r={pageX:"clientX",pageY:"clientY"};return e in r&&!(e in t)&&r[e]in t&&(e=r[e]),t[e]}return e.attach("intg.dragula",function(e,n){var t,i,x,b,w,T,O,X,Y,I,B;1===arguments.length&&!1===Array.isArray(e)&&(n=e,e=[]);var D,P=null,R=n||{};void 0===R.moves&&(R.moves=g),void 0===R.accepts&&(R.accepts=g),void 0===R.invalid&&(R.invalid=function(){return!1}),void 0===R.containers&&(R.containers=e||[]),void 0===R.isContainer&&(R.isContainer=m),void 0===R.copy&&(R.copy=!1),void 0===R.copySortSource&&(R.copySortSource=!1),void 0===R.revertOnSpill&&(R.revertOnSpill=!1),void 0===R.removeOnSpill&&(R.removeOnSpill=!1),void 0===R.direction&&(R.direction="vertical"),void 0===R.ignoreInputTextSelection&&(R.ignoreInputTextSelection=!0),void 0===R.mirrorContainer&&(R.mirrorContainer=l.body);var A=a({containers:R.containers,start:function(e){var n=q(e);n&&G(n)},end:H,cancel:V,remove:U,destroy:function(){N(!0),L({})},canMove:function(e){return!!q(e)},dragging:!1});return!0===R.removeOnSpill&&A.on("over",function(e){c.removeClass(e,"gu-hide")}).on("out",function(e){A.dragging&&c.addClass(e,"gu-hide")}),N(),A;function K(e){return-1!==A.containers.indexOf(e)||R.isContainer(e)}function N(e){var n=e?"remove":"add";v(d,n,"mousedown",M),v(d,n,"mouseup",L)}function z(e){v(d,e?"remove":"add","mousemove",j)}function E(e){var n=e?"off":"on";u[n](d,"selectstart",F),u[n](d,"click",F)}function F(e){D&&e.preventDefault()}function M(e){if(T=e.clientX,O=e.clientY,1===f(e)&&!e.metaKey&&!e.ctrlKey){var n=e.target,t=q(n);t&&(D=t,z(),"mousedown"===e.type&&(C(n)?n.focus():e.preventDefault()))}}function j(e){if(D)if(0!==f(e)){if(void 0===e.clientX||e.clientX!==T||void 0===e.clientY||e.clientY!==O){if(R.ignoreInputTextSelection){var n=k("clientX",e),i=k("clientY",e);if(C(r.fromPoint(n,i)))return}var u=D;z(!0),E(),H(),G(u);var a,l=(a=x,o.pagePosition(a));b=k("pageX",e)-l.left,w=k("pageY",e)-l.top,c.addClass(I||x,"gu-transit"),function(){if(!t){var e=x.getBoundingClientRect();(t=x.cloneNode(!0)).style.width=p(e)+"px",t.style.height=h(e)+"px",c.removeClass(t,"gu-transit"),c.addClass(t,"gu-mirror"),R.mirrorContainer.appendChild(t),v(d,"add","mousemove",_),c.addClass(R.mirrorContainer,"gu-unselectable"),A.emit("cloned",t,x,"mirror")}}(),_(e)}}else L({})}function q(e){if(!(A.dragging&&t||K(e))){for(var n=e;y(e)&&!1===K(y(e));){if(R.invalid(e,n))return;if(!(e=y(e)))return}var r=y(e);if(r&&!R.invalid(e,n)&&R.moves(e,r,n,S(e)))return{item:e,source:r}}}function G(e){var n,t;n=e.item,t=e.source,("boolean"==typeof R.copy?R.copy:R.copy(n,t))&&(I=e.item.cloneNode(!0),A.emit("cloned",I,e.item,"copy")),i=e.source,x=e.item,X=Y=S(e.item),A.dragging=!0,A.emit("drag",x,i)}function H(){if(A.dragging){var e=I||x;Q(e,y(e))}}function J(){D=!1,z(!0),E(!0)}function L(e){if(J(),A.dragging){var n=I||x,t=k("clientX",e),r=k("clientY",e),o=$(s(0,t,r),t,r);o&&(I&&R.copySortSource||!I||o!==i)?Q(n,o):R.removeOnSpill?U():V()}}function Q(e,n){var t=y(e);I&&R.copySortSource&&n===i&&t.removeChild(x),Z(n)?A.emit("cancel",e,i,i):A.emit("drop",e,n,i,Y),W()}function U(){if(A.dragging){var e=I||x,n=y(e);n&&n.removeChild(e),A.emit(I?"cancel":"remove",e,n,i),W()}}function V(e){if(A.dragging){var n=arguments.length>0?e:R.revertOnSpill,t=I||x,r=y(t),o=Z(r);!1===o&&n&&(I?r&&r.removeChild(I):i.insertBefore(t,X)),o||n?A.emit("cancel",t,i,i):A.emit("drop",t,r,i,Y),W()}}function W(){var e=I||x;J(),t&&(c.removeClass(R.mirrorContainer,"gu-unselectable"),v(d,"remove","mousemove",_),y(t).removeChild(t),t=null),e&&c.removeClass(e,"gu-transit"),B&&clearTimeout(B),A.dragging=!1,P&&A.emit("out",e,P,i),A.emit("dragend",e),i=x=I=X=Y=B=P=null}function Z(e,n){var r;return r=void 0!==n?n:t?Y:S(I||x),e===i&&r===X}function $(e,n,t){for(var r=e;r&&!o();)r=y(r);return r;function o(){if(!1===K(r))return!1;var o=ee(r,e),u=ne(r,o,n,t);return!!Z(r,u)||R.accepts(x,r,i,u)}}function _(e){if(t){e.preventDefault();var n=k("clientX",e),r=k("clientY",e),o=n-b,u=r-w;t.style.left=o+"px",t.style.top=u+"px";var c=I||x,a=s(0,n,r),l=$(a,n,r),d=null!==l&&l!==P;(d||null===l)&&(P&&g("out"),P=l,d&&g("over"));var v=y(c);if(l!==i||!I||R.copySortSource){var f,m=ee(l,a);if(null!==m)f=ne(l,m,n,r);else{if(!0!==R.revertOnSpill||I)return void(I&&v&&v.removeChild(c));f=X,l=i}(null===f&&d||f!==c&&f!==S(c))&&(Y=f,l.insertBefore(c,f),A.emit("shadow",c,l,i))}else v&&v.removeChild(c)}function g(e){A.emit(e,c,P,i)}}function ee(e,n){for(var t=n;t!==e&&y(t)!==e;)t=y(t);return t===d?null:t}function ne(e,n,t,r){var i,u="horizontal"===R.direction;return n!==e?(i=o.boundingRect(n),c(u?t>i.left+p(i)/2:r>i.top+h(i)/2)):function(){var n,i,c,a=e.children.length;for(n=0;n<a;n++){if(i=e.children[n],c=o.boundingRect(i),u&&c.left+c.width/2>t)return i;if(!u&&c.top+c.height/2>r)return i}return null}();function c(e){return e?S(n):n}}})});
//# sourceMappingURL=sourcemaps/dragula.js.map
