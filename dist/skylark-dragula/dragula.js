/**
 * skylark-dragula - A version of dragula.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-dragula/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-devices-points/mouse","skylark-devices-points/touch","skylark-domx-noder","skylark-domx-finder","skylark-domx-geom","skylark-domx-eventer","skylark-domx-styler","./emitter"],function(e,n,t,r,i,o,a,c,u){"use strict";var l=window.document,d=l.documentElement;function v(e,n,r,i){"add"==n?a.on(e,r,i):a.off(e,r,i),e.touchInited||(e.touchInited=!0,t.mousy(e))}function f(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var n=e.button;return void 0!==n?1&n?1:2&n?3:4&n?2:0:void 0}function s(){return!1}function g(){return!0}function m(e){return e.width||e.right-e.left}function p(e){return e.height||e.bottom-e.top}function h(e,n){var t=function(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}(n),r={pageX:"clientX",pageY:"clientY"};return e in r&&!(e in t)&&r[e]in t&&(e=r[e]),t[e]}return e.attach("intg.dragula",function(e,n){var t,y,S,C,k,x,b,w,T,O,X;1===arguments.length&&!1===Array.isArray(e)&&(n=e,e=[]);var Y,I=null,P=n||{};void 0===P.moves&&(P.moves=g),void 0===P.accepts&&(P.accepts=g),void 0===P.invalid&&(P.invalid=function(){return!1}),void 0===P.containers&&(P.containers=e||[]),void 0===P.isContainer&&(P.isContainer=s),void 0===P.copy&&(P.copy=!1),void 0===P.copySortSource&&(P.copySortSource=!1),void 0===P.revertOnSpill&&(P.revertOnSpill=!1),void 0===P.removeOnSpill&&(P.removeOnSpill=!1),void 0===P.direction&&(P.direction="vertical"),void 0===P.ignoreInputTextSelection&&(P.ignoreInputTextSelection=!0),void 0===P.mirrorContainer&&(P.mirrorContainer=l.body);var B=u({containers:P.containers,start:function(e){var n=M(e);n&&j(n)},end:q,cancel:L,remove:J,destroy:function(){R(!0),G({})},canMove:function(e){return!!M(e)},dragging:!1});return!0===P.removeOnSpill&&B.on("over",function(e){c.removeClass(e,"gu-hide")}).on("out",function(e){B.dragging&&c.addClass(e,"gu-hide")}),R(),B;function D(e){return-1!==B.containers.indexOf(e)||P.isContainer(e)}function R(e){var n=e?"remove":"add";v(d,n,"mousedown",z),v(d,n,"mouseup",G)}function A(e){v(d,e?"remove":"add","mousemove",E)}function K(e){var n=e?"off":"on";a[n](d,"selectstart",N),a[n](d,"click",N)}function N(e){Y&&e.preventDefault()}function z(e){if(x=e.clientX,b=e.clientY,1===f(e)&&!e.metaKey&&!e.ctrlKey){var n=e.target,t=M(n);t&&(Y=t,A(),"mousedown"===e.type&&(r.isInput(n)?n.focus():e.preventDefault()))}}function E(e){if(Y)if(0!==f(e)){if(void 0===e.clientX||e.clientX!==x||void 0===e.clientY||e.clientY!==b){if(P.ignoreInputTextSelection){var n=h("clientX",e),i=h("clientY",e),a=r.fromPoint(n,i);if(r.isInput(a))return}var u=Y;A(!0),K(),q(),j(u);var l=o.pagePosition(S);C=h("pageX",e)-l.left,k=h("pageY",e)-l.top,c.addClass(O||S,"gu-transit"),function(){if(!t){var e=S.getBoundingClientRect();(t=S.cloneNode(!0)).style.width=m(e)+"px",t.style.height=p(e)+"px",c.removeClass(t,"gu-transit"),c.addClass(t,"gu-mirror"),P.mirrorContainer.appendChild(t),v(d,"add","mousemove",W),c.addClass(P.mirrorContainer,"gu-unselectable"),B.emit("cloned",t,S,"mirror")}}(),W(e)}}else G({})}function M(e){if(!(B.dragging&&t||D(e))){for(var n=e;i.parent(e)&&!1===D(i.parent(e));){if(P.invalid(e,n))return;if(!(e=i.parent(e)))return}var r=i.parent(e);if(r&&!P.invalid(e,n)&&P.moves(e,r,n,i.nextSibling(e)))return{item:e,source:r}}}function j(e){var n,t;n=e.item,t=e.source,("boolean"==typeof P.copy?P.copy:P.copy(n,t))&&(O=e.item.cloneNode(!0),B.emit("cloned",O,e.item,"copy")),y=e.source,S=e.item,w=T=i.nextSibling(e.item),B.dragging=!0,B.emit("drag",S,y)}function q(){if(B.dragging){var e=O||S;H(e,i.parent(e))}}function F(){Y=!1,A(!0),K(!0)}function G(e){if(F(),B.dragging){var n=O||S,t=h("clientX",e),i=h("clientY",e),o=V(r.fromPoint(t,i),t,i);o&&(O&&P.copySortSource||!O||o!==y)?H(n,o):P.removeOnSpill?J():L()}}function H(e,n){var t=i.parent(e);O&&P.copySortSource&&n===y&&t.removeChild(S),U(n)?B.emit("cancel",e,y,y):B.emit("drop",e,n,y,T),Q()}function J(){if(B.dragging){var e=O||S,n=i.parent(e);n&&n.removeChild(e),B.emit(O?"cancel":"remove",e,n,y),Q()}}function L(e){if(B.dragging){var n=arguments.length>0?e:P.revertOnSpill,t=O||S,r=i.parent(t),o=U(r);!1===o&&n&&(O?r&&r.removeChild(O):y.insertBefore(t,w)),o||n?B.emit("cancel",t,y,y):B.emit("drop",t,r,y,T),Q()}}function Q(){var e=O||S;F(),t&&(c.removeClass(P.mirrorContainer,"gu-unselectable"),v(d,"remove","mousemove",W),i.parent(t).removeChild(t),t=null),e&&c.removeClass(e,"gu-transit"),X&&clearTimeout(X),B.dragging=!1,I&&B.emit("out",e,I,y),B.emit("dragend",e),y=S=O=w=T=X=I=null}function U(e,n){var r;return r=void 0!==n?n:t?T:i.nextSibling(O||S),e===y&&r===w}function V(e,n,t){for(var r=e;r&&!o();)r=i.parent(r);return r;function o(){if(!1===D(r))return!1;var i=Z(r,e),o=$(r,i,n,t);return!!U(r,o)||P.accepts(S,r,y,o)}}function W(e){if(t){e.preventDefault();var n=h("clientX",e),o=h("clientY",e),a=n-C,c=o-k;t.style.left=a+"px",t.style.top=c+"px";var u=O||S,l=r.fromPoint(n,o),d=V(l,n,o),v=null!==d&&d!==I;(v||null===d)&&(I&&m("out"),I=d,v&&m("over"));var f=i.parent(u);if(d!==y||!O||P.copySortSource){var s,g=Z(d,l);if(null!==g)s=$(d,g,n,o);else{if(!0!==P.revertOnSpill||O)return void(O&&f&&f.removeChild(u));s=w,d=y}(null===s&&v||s!==u&&s!==i.nextSibling(u))&&(T=s,d.insertBefore(u,s),B.emit("shadow",u,d,y))}else f&&f.removeChild(u)}function m(e){B.emit(e,u,I,y)}}function Z(e,n){for(var t=n;t!==e&&i.parent(t)!==e;)t=i.parent(t);return t===d?null:t}function $(e,n,t,r){var a,c="horizontal"===P.direction;return n!==e?(a=o.boundingRect(n),u(c?t>a.left+m(a)/2:r>a.top+p(a)/2)):function(){var n,i,a,u=e.children.length;for(n=0;n<u;n++){if(i=e.children[n],a=o.boundingRect(i),c&&a.left+a.width/2>t)return i;if(!c&&a.top+a.height/2>r)return i}return null}();function u(e){return e?i.nextSibling(n):n}}})});
//# sourceMappingURL=sourcemaps/dragula.js.map
